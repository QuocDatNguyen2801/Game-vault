<div class="container-fluid cart-background mt-2 pt-4 pb-5">
  <div class="container">
    <nav
      style="--bs-breadcrumb-divider: url(&#34;data:image/svg + xml,%3Csvgxmlns='http://www.w3.org/2000/svg'width='8'height='8'%3E%3Cpathd='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z'fill='%23ffffff'/%3E%3C/svg%3E&#34;);"
      aria-label="breadcrumb"
    >
      <ol class="breadcrumb">
        <li class="breadcrumb-item">
          <a href="/" class="text-decoration-none text-light">Home</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">
          <a href="/cart" class="text-decoration-none text-light">Cart</a>
        </li>
      </ol>
    </nav>
    <h1 class="shopping-title fw-bold">Shopping Cart</h1>

    <% if (!cart || cart.items.length === 0) { %>
    <div class="row mt-4">
      <div
        class="col-md customize-empty-background d-flex flex-column justify-content-center align-items-center gap-3 py-5"
      >
        <p class="my-0 muted fs-5">Your cart is empty</p>
        <a
          href="/shop/admin"
          class="text-decoration-none p-2 mt-0 continue-shop-btn rounded-3 px-3"
          >Continue Shopping</a
        >
      </div>
    </div>
    <% } else { %>
    <div class="row mt-md-5 mt-3">
      <div
        class="col-md-8 col d-flex flex-column justify-content-start align-items-stretch gap-4"
      >
        <% cart.items.forEach(item => { %> <% let displayPrice = (typeof
        item.price === 'number') ? item.price : (item.productId && typeof
        item.productId.price === 'number' ? item.productId.price : 0);
        if(item.edition === 'Deluxe') displayPrice += 10; if(item.edition ===
        'Ultimate') displayPrice += 20; displayPrice =
        Number(displayPrice.toFixed(2)); %>

        <div
          class="cart-item d-flex align-items-start justify-content-between rounded-3 p-0 overflow-hidden"
        >
          <div
            class="d-flex flex-md-row flex-column justify-content-md-start align-items-md-start justify-content-stretch align-items-stretch cart-details border-0 outline-0 p-4 gap-3"
          >
            <img
              src="<%= item.image %>"
              class="customize-cart-img img-fluid d-block h-25 w-25"
              alt="<%= item.title %>"
            />

            <div class="card-body">
              <h5 class="card-title fw-bold"><%= item.title %></h5>
              <p class="card-text muted">Edition: <%= item.edition %></p>
              <p class="card-text price fw-bold">
                $<%= Number(displayPrice).toFixed(2) %>
              </p>

              <div
                class="quantity-container d-flex flex-row align-items-center justify-content-stretch gap-2"
              >
                <form
                  action="/cart/update/<%= item._id %>"
                  method="POST"
                  class="d-flex flex-row align-items-center justify-content-stretch gap-2"
                >
                  <p class="card-text fw-bold quantity-title mb-0">Quantity:</p>
                  <input
                    type="number"
                    min="1"
                    value="<%= item.quantity %>"
                    id="quantity"
                    name="quantity"
                    class="cart-quantity border-0 outline-0 px-md-2 py-md-1 px-5 py-2 text-center"
                    onchange="this.form.submit()"
                  />
                </form>

                <form
                  action="/cart/delete/<%= item._id %>?_method=DELETE"
                  method="POST"
                  class="d-inline p-3"
                >
                  <button
                    type="submit"
                    class="trash-icon border-0 outline-0 py-1 px-2"
                  >
                    <i class="bi bi-trash"></i>
                  </button>
                </form>
              </div>
            </div>
          </div>

          <span class="price-custom fw-bold fs-4 mt-3 me-3 d-md-inline d-none"
            >$<%= (displayPrice * item.quantity).toFixed(2) %></span
          >
        </div>
        <% }) %>
      </div>

      <div class="col-md-4 col mt-md-0 mt-5">
        <div class="order-container p-4 pt-3 sticky-top">
          <span class="order-summary fw-bold my-0 fs-3">Order Summary</span>

          <div
            class="d-flex flex-column align-items-center justify-content-center gap-3 mt-4"
          >
            <div
              class="subtotal-container d-flex flex-row align-items-center justify-content-between w-100"
            >
              <span class="subtotal-title">Subtotal</span>
              <span class="subtotal-price">$<%= totals.subtotal %></span>
            </div>

            <div
              class="tax-container d-flex flex-row align-items-center justify-content-between w-100"
            >
              <span class="tax-title">Tax (10%)</span>
              <span class="tax-price">$<%= totals.tax %></span>
            </div>

            <hr class="hr w-100 mt-3 mb-1" />

            <div
              class="total-container d-flex flex-row align-items-center justify-content-between w-100"
            >
              <span class="total-title fw-bold">Total</span>
              <span class="total-price fw-bold">$<%= totals.total %></span>
            </div>

            <a
              href="/checkout"
              class="proceed-btn text-decoration-none w-100 text-center p-2 mt-3"
              >Proceed to Checkout</a
            >
            <a
              href="/shop/admin"
              class="shop-btn text-decoration-none w-100 text-center p-2"
              >Continue Shopping</a
            >
          </div>
        </div>
      </div>
    </div>
    <% } %>
  </div>
</div>
